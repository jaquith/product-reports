{"test":{},"lastmanageid":"1","revision":"202009231152","importable_library":"NONE","publish":{"smartFTP":{"qa":"init","dev":"preMCDN","prod":"init"},"minify":"yes","enable_utf8_encoding":"yes"},"linkedProfiles":"{ }","label_relationships":null,"profile":"pro7-flaconi-staging","publish_history":{"202009231152":{"title":"Initial publish","202009231152":{"versionorigin":"","publishedConsent":"","notes":"Initial publish on profile creation","action":"Published to dev","lastmanageid":"","status":"prod,qa,dev","publishedTags":"[ ]","operator":"caleb.jaquith@tealium.com","history":"","title":"Initial publish","lastcustomizeid":"","datacloudLinkedProfiles":"{}","publishedExtensions":"[ \"2\" , \"3\" , \"4\" , \"8\"]","linkedProfiles":"{ }"},"status":"qa,prod","size":"33"},"202009231204":{"202009231204":{"publishedTags":"[ \"1\"]","operator":"caleb.jaquith@tealium.com","lastmanageid":"1","status":"dev","action":"Published to dev","publishedConsent":"[ ]","notes":"Add Collect tag","versionorigin":"202009231152","publishedExtensions":"[ \"2\" , \"3\" , \"4\" , \"8\"]","linkedProfiles":"{ }","datacloudLinkedProfiles":"{&quot;main&quot;:{&quot;rev&quot;:&quot;1600247595895&quot;,&quot;env&quot;:&quot;AudienceStream&quot;}}","history":"[ { \"action\" : \"added_tag\" , \"data\" : { \"id\" : \"1\" , \"tag_name\" : \"Tealium Collect\" , \"library\" : \"\" , \"name\" : \"Tealium Collect\" , \"kind\" : \"Tag\" , \"operation\" : \"added\" , \"container\" : \"manage_content_160086239355800006\" , \"tab_name\" : \"manage\"}}]","lastcustomizeid":"0","title":"Version 2020.09.23.1203"},"title":"Version 2020.09.23.1203","size":"50","status":"dev"}},"account":"services-caleb","lastcustomizeid":"0","history":"[ { \"action\" : \"added_tag\" , \"data\" : { \"id\" : \"1\" , \"tag_name\" : \"Tealium Collect\" , \"library\" : \"\" , \"name\" : \"Tealium Collect\" , \"kind\" : \"Tag\" , \"operation\" : \"added\" , \"container\" : \"manage_content_160086239355800006\" , \"tab_name\" : \"manage\"}}]","profile_action_type":"SaveAs","define":{"81":{"_id":"81","name":"Account Value Strings","type":"va","description":"Should contain account numbers and their value band","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5217","origin_name":"Account Value Strings","origin_type":"property_lists","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"82":{"_id":"82","name":"Active browser type","type":"va","description":"The browser actively being used by the visitor","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"44","origin_name":"Active browser type","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"83":{"_id":"83","name":"Active browser version","type":"va","description":"The browser version actively being used by the visitor","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"48","origin_name":"Active browser version","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"84":{"_id":"84","name":"Active device","type":"va","description":"The device actively being used by the visitor","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"46","origin_name":"Active device","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"85":{"_id":"85","name":"Active operating system","type":"va","description":"The operating system actively being used by the visitor","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"45","origin_name":"Active operating system","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"86":{"_id":"86","name":"Active platform","type":"va","description":"The platform actively being used by the visitor","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"47","origin_name":"Active platform","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"87":{"_id":"87","name":"Average visit duration in minutes","type":"va","description":"Average visit duration in minutes","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"26","origin_name":"Average visit duration in minutes","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"88":{"_id":"88","name":"Average visits per week","type":"va","description":"Average visits per week","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"29","origin_name":"Average visits per week","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"89":{"_id":"89","name":"Batch Tester","type":"va","description":"Testing the batch webhook","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5189","origin_name":"Batch Tester","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"90":{"_id":"90","name":"Blue","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5067","origin_name":"Blue","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"91":{"_id":"91","name":"Brown","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5055","origin_name":"Brown","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"92":{"_id":"92","name":"Cookie Sync ID - Assigned Rule","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5075","origin_name":"Cookie Sync ID - Assigned Rule","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"93":{"_id":"93","name":"Cookie Sync ID - No Rule","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5079","origin_name":"Cookie Sync ID - No Rule","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"94":{"_id":"94","name":"Counter (Last Seen)","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5193","origin_name":"Counter (Last Seen)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"95":{"_id":"95","name":"Direct visit","type":"va","description":"The user navigated directly to the site","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"14","origin_name":"Direct visit","origin_type":"flags","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"96":{"_id":"96","name":"Entry URL","type":"va","description":"URL of the first page visited","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"5","origin_name":"Entry URL","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"97":{"_id":"97","name":"Event count","type":"va","description":"Total number of events in visit","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"7","origin_name":"Event count","origin_type":"metrics","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"98":{"_id":"98","name":"Exit URL","type":"va","description":"URL of the last page visited","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"6","origin_name":"Exit URL","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"99":{"_id":"99","name":"Fan","type":"va","description":"More than two total visits and more direct visits than refers","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"30","origin_name":"Fan","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"100":{"_id":"100","name":"First 'test_value' only","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5183","origin_name":"First 'test_value' only","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"101":{"_id":"101","name":"First visit","type":"va","description":"Date of first visit","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"23","origin_name":"First visit","origin_type":"dates","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"102":{"_id":"102","name":"Frequent visitor","type":"va","description":"Two or more average visits per week","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"31","origin_name":"Frequent visitor","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"103":{"_id":"103","name":"Full entry URL (with attribution)","type":"va","description":"","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"5090","origin_name":"Full entry URL (with attribution)","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"104":{"_id":"104","name":"Google GID","type":"va","description":"From the Google Cookie Match, saved here as string ","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5038","origin_name":"Google GID","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"105":{"_id":"105","name":"Green","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5063","origin_name":"Green","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"106":{"_id":"106","name":"GUID - Compromised Profile","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5179","origin_name":"GUID - Compromised Profile","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"107":{"_id":"107","name":"GUID - Compromised profile and a new visit [bln]","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5340","origin_name":"GUID - Compromised profile and a new visit [bln]","origin_type":"flags","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"108":{"_id":"108","name":"GUID - Count Has Changed This Visit","type":"va","description":"","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"5332","origin_name":"GUID - Count Has Changed This Visit","origin_type":"flags","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"109":{"_id":"109","name":"GUID - Count of seen [num]","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5175","origin_name":"GUID - Count of seen [num]","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"110":{"_id":"110","name":"GUID - Healthy Profile","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5177","origin_name":"GUID - Healthy Profile","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"111":{"_id":"111","name":"GUID - Incomplete Profile","type":"va","description":"Should not use this profile, it's been used on a shared device and only contains partial information","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5334","origin_name":"GUID - Incomplete Profile","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"112":{"_id":"112","name":"GUID - Last seen [str]","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5169","origin_name":"GUID - Last seen [str]","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"113":{"_id":"113","name":"GUID - None","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5181","origin_name":"GUID - None","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"114":{"_id":"114","name":"Has Cookie Sync ID - With Rule","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5077","origin_name":"Has Cookie Sync ID - With Rule","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"115":{"_id":"115","name":"Has Cookie Sync ID - Without Rule","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5081","origin_name":"Has Cookie Sync ID - Without Rule","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"116":{"_id":"116","name":"Hyphen Lover","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5088","origin_name":"Hyphen Lover","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"117":{"_id":"117","name":"Import - Age","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5165","origin_name":"Import - Age","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"118":{"_id":"118","name":"Import - Alpha","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5161","origin_name":"Import - Alpha","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"119":{"_id":"119","name":"Import - Bool","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5167","origin_name":"Import - Bool","origin_type":"flags","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"120":{"_id":"120","name":"Import - Row Number","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5163","origin_name":"Import - Row Number","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"121":{"_id":"121","name":"Last 'test_value'","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5187","origin_name":"Last 'test_value'","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"122":{"_id":"122","name":"Last conversion partner name","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5034","origin_name":"Last conversion partner name","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"123":{"_id":"123","name":"Last event time","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5318","origin_name":"Last event time","origin_type":"dates","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"124":{"_id":"124","name":"Last event URL","type":"va","description":"Last event URL for visitor","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"17","origin_name":"Last event URL","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"125":{"_id":"125","name":"Last UDO String","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5145","origin_name":"Last UDO String","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"126":{"_id":"126","name":"Last visit","type":"va","description":"Date of last visit","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"24","origin_name":"Last visit","origin_type":"dates","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"127":{"_id":"127","name":"Last-seen tealium_event [str]","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5324","origin_name":"Last-seen tealium_event [str]","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"128":{"_id":"128","name":"Last-seen Trace Id","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5320","origin_name":"Last-seen Trace Id","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"129":{"_id":"129","name":"Lifetime browser types used (favorite)","type":"va","description":"Captures the favorite metric for Metric Set: Lifetime browser types used","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"56","origin_name":"Lifetime browser types used (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"130":{"_id":"130","name":"Lifetime browser versions used (favorite)","type":"va","description":"Captures the favorite metric for Metric Set: Lifetime browser versions used","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"62","origin_name":"Lifetime browser versions used (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"131":{"_id":"131","name":"Lifetime devices used (favorite)","type":"va","description":"Captures the favorite metric for Metric Set: Lifetime devices used","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"54","origin_name":"Lifetime devices used (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"132":{"_id":"132","name":"Lifetime event count","type":"va","description":"Total number of events triggered by user","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"22","origin_name":"Lifetime event count","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"133":{"_id":"133","name":"Lifetime operating systems used (favorite)","type":"va","description":"Captures the favorite metric for Metric Set: Lifetime operating systems used","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"58","origin_name":"Lifetime operating systems used (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"134":{"_id":"134","name":"Lifetime order total","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5028","origin_name":"Lifetime order total","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"135":{"_id":"135","name":"Lifetime order total by partner name (favorite)","type":"va","description":"Captures the favorite number for Tally: Lifetime order total by partner name","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5031","origin_name":"Lifetime order total by partner name (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"136":{"_id":"136","name":"Lifetime platforms used (favorite)","type":"va","description":"Captures the favorite metric for Metric Set: Lifetime platforms used","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"60","origin_name":"Lifetime platforms used (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"137":{"_id":"137","name":"LIfetime Test Stream Values (favorite)","type":"va","description":"Captures the favorite number for Tally: LIfetime Test Stream Values","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5132","origin_name":"LIfetime Test Stream Values (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"138":{"_id":"138","name":"Lifetime visit count","type":"va","description":"Total number of times user has visited site","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"21","origin_name":"Lifetime visit count","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"139":{"_id":"139","name":"Light Blue","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5065","origin_name":"Light Blue","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"140":{"_id":"140","name":"Most Recent GCLID","type":"va","description":"This setup ignores the edge case where a user could click two ads from this campaign within the same session - it will only send the last GCLID in those cases.","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5312","origin_name":"Most Recent GCLID","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"141":{"_id":"141","name":"Most Recent GCLID has changed this visit","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5314","origin_name":"Most Recent GCLID has changed this visit","origin_type":"flags","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"142":{"_id":"142","name":"NO BOUNCERS HERE","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5322","origin_name":"NO BOUNCERS HERE","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"143":{"_id":"143","name":"Optin (imported)","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5149","origin_name":"Optin (imported)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"144":{"_id":"144","name":"Orange","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5059","origin_name":"Orange","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"145":{"_id":"145","name":"Pink","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5069","origin_name":"Pink","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"146":{"_id":"146","name":"Product Prices Purchases - Last Order Imported (favorite)","type":"va","description":"Captures the favorite number for Tally: Product Prices Purchases - Last Order Imported","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"5120","origin_name":"Product Prices Purchases - Last Order Imported (favorite)","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"147":{"_id":"147","name":"Product Purchase Count (Lifetime) (favorite)","type":"va","description":"Captures the favorite number for Tally: Product Purchase Count (Lifetime)","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5118","origin_name":"Product Purchase Count (Lifetime) (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"148":{"_id":"148","name":"Red","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5057","origin_name":"Red","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"149":{"_id":"149","name":"Referred visit","type":"va","description":"The user was referred from another site","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"13","origin_name":"Referred visit","origin_type":"flags","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"150":{"_id":"150","name":"Referrer","type":"va","description":"","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"5092","origin_name":"Referrer","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"151":{"_id":"151","name":"Returning visitor","type":"va","description":"Return visitor","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"27","origin_name":"Returning visitor","origin_type":"flags","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"152":{"_id":"152","name":"Spend per Product (Lifetime) (favorite)","type":"va","description":"Captures the favorite number for Tally: Spend per Product (Lifetime)","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5122","origin_name":"Spend per Product (Lifetime) (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"153":{"_id":"153","name":"Tealium Test Visit","type":"va","description":"Set via query parameter &quot;tealium_test_visit=true&quot;","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"5125","origin_name":"Tealium Test Visit","origin_type":"flags","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"154":{"_id":"154","name":"Tealium Visitor ID (Last Seen)","type":"va","description":"3rd party wins if present","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5129","origin_name":"Tealium Visitor ID (Last Seen)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"155":{"_id":"155","name":"tealium_cf_visit_ttl","type":"va","description":"","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"82","origin_name":"tealium_cf_visit_ttl","origin_type":"properties","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"156":{"_id":"156","name":"Test Date","type":"va","description":"Expects format 2020-08-27T13:13:47.395Z ","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5195","origin_name":"Test Date","origin_type":"dates","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"157":{"_id":"157","name":"Test Tally (favorite)","type":"va","description":"Captures the favorite number for Tally: Test Tally","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5093","origin_name":"Test Tally (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"158":{"_id":"158","name":"test_tiq_string values (favorite)","type":"va","description":"Captures the favorite number for Tally: test_tiq_string values","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5136","origin_name":"test_tiq_string values (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"159":{"_id":"159","name":"test_udo_string values (favorite)","type":"va","description":"Captures the favorite number for Tally: test_udo_string values","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5138","origin_name":"test_udo_string values (favorite)","origin_type":"properties","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"160":{"_id":"160","name":"Tester","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5141","origin_name":"Tester","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"161":{"_id":"161","name":"Total direct visits","type":"va","description":"Total direct visits","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"15","origin_name":"Total direct visits","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"162":{"_id":"162","name":"Total referred visits","type":"va","description":"Total referred visits","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"16","origin_name":"Total referred visits","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"163":{"_id":"163","name":"Total time spent on site in minutes","type":"va","description":"Sum duration of all user visits","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"25","origin_name":"Total time spent on site in minutes","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"164":{"_id":"164","name":"Unbadged","type":"va","description":"The visitor has not been assigned any badges","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"32","origin_name":"Unbadged","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"165":{"_id":"165","name":"Visit duration","type":"va","description":"Visit duration in minutes","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"12","origin_name":"Visit duration","origin_type":"metrics","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"166":{"_id":"166","name":"Visit end","type":"va","description":"Visit end date","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"11","origin_name":"Visit end","origin_type":"dates","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"167":{"_id":"167","name":"Visit start","type":"va","description":"Visit start date","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"10","origin_name":"Visit start","origin_type":"dates","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"168":{"_id":"168","name":"Weeks since first visit","type":"va","description":"Weeks elapsed since first visit","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"28","origin_name":"Weeks since first visit","origin_type":"metrics","origin_context":"visitor","account":"services-caleb","profileid":"main"}},"169":{"_id":"169","name":"Weeks since first visit temp","type":"va","description":"Temporary store for computer value","context":"current_visit","imported":"AudienceStream","settings":{"origin_id":"80","origin_name":"Weeks since first visit temp","origin_type":"metrics","origin_context":"current_visit","account":"services-caleb","profileid":"main"}},"170":{"_id":"170","name":"Yellow","type":"va","description":"","context":"visitor","imported":"AudienceStream","settings":{"origin_id":"5061","origin_name":"Yellow","origin_type":"badges","origin_context":"visitor","account":"services-caleb","profileid":"main"}}},"manage":{"1":{"config_data_source":"","selectedTargets":{"qa":"true","dev":"true","prod":"true"},"sort":"0","new_flag":"true","notes":"","publish_revisions":{"last_modified":"202009231204","svr_save_timestamps":{"dev":"202009231204"}},"tag_id":"20064","_id":"1","config_region":"eu-central-1","advconfig_src":"","advconfig_send":"yes","config_server":"","advconfig_optout":"yes","loadrule_join_operator":"all","config_enrichment":"none","scope":"all","status":"active","id":"1","title":"Tealium Collect","config_profile":"","loadrule":"all","tag_name":"Tealium Collect","advconfig_loadtype":"","config_sampling":"100","advconfig_bundle":"no","advconfig_wait":"yes"}},"createManifest":"false","versionorigin":"202009231152","settings":{"datacloud_revision":"1600247595895","lastdefineid":"80","lastcustomizeid":"0","profileid":"pro7-flaconi-staging","account":"services-caleb","datacloud_profile":"main","revision":"202009231204","creation":"202009231152","lastloadruleid":"1","lastmanageid":"1","minorrevision":"202009231204","library":"NONE"},"customizations":{"2":{"id":"100040","title":"GTM Listener (2/4) - Data Layer Helper Library (provided by Google)","codeDevData":{"queueSeq":"5","draftSnippets":{"dc20b3d5d2cddf82fad332821ca5e9a4efdcede4a273aa193d2b495bdcc92825":{"updateDate":"201906200733","creationDate":"201906200703","updatedBy":"caleb.jaquith@tealium.com","code":"/**\n * Scope       : DOM Ready\n * Execution   : n/a\n * Condition   : n/a\n * Description : GTM Listener - Data Layer Helper Library (provided by Google), makes it easy to queue \n *               events. We use it here to process existing GTM Events for Collect\n * \n * Documentation: https://github.com/google/data-layer-helper\n * Source: https://raw.githubusercontent.com/google/data-layer-helper/master/dist/data-layer-helper.js\n *\n*/\n\n(function(){/*\n  jQuery v1.9.1 (c) 2005, 2012\n  jQuery Foundation, Inc. jquery.org/license.\n */\n var g=/\\[object (Boolean|Number|String|Function|Array|Date|RegExp)\\]/;function h(a){return null==a?String(a):(a=g.exec(Object.prototype.toString.call(Object(a))))?a[1].toLowerCase():&quot;object&quot;}function k(a,b){return Object.prototype.hasOwnProperty.call(Object(a),b)}function m(a){if(!a||&quot;object&quot;!=h(a)||a.nodeType||a==a.window)return!1;try{if(a.constructor&amp;&amp;!k(a,&quot;constructor&quot;)&amp;&amp;!k(a.constructor.prototype,&quot;isPrototypeOf&quot;))return!1}catch(b){return!1}for(var c in a);return void 0===c||k(a,c)};/*\n  Copyright 2012 Google Inc. All rights reserved. */\n function n(a,b,c){this.b=a;this.f=b||function(){};this.d=!1;this.a={};this.c=[];this.e=p(this);r(this,a,!c);var d=a.push,e=this;a.push=function(){var b=[].slice.call(arguments,0),c=d.apply(a,b);r(e,b);return c}}window.DataLayerHelper=n;n.prototype.get=function(a){var b=this.a;a=a.split(&quot;.&quot;);for(var c=0;c&lt;a.length;c++){if(void 0===b[a[c]])return;b=b[a[c]]}return b};n.prototype.flatten=function(){this.b.splice(0,this.b.length);this.b[0]={};s(this.a,this.b[0])};\n function r(a,b,c){for(a.c.push.apply(a.c,b);!1===a.d&amp;&amp;0&lt;a.c.length;){b=a.c.shift();if(&quot;array&quot;==h(b))a:{var d=b,e=a.a;if(&quot;string&quot;==h(d[0])){for(var f=d[0].split(&quot;.&quot;),u=f.pop(),d=d.slice(1),l=0;l&lt;f.length;l++){if(void 0===e[f[l]])break a;e=e[f[l]]}try{e[u].apply(e,d)}catch(v){}}}else if(&quot;function&quot;==typeof b)try{b.call(a.e)}catch(w){}else if(m(b))for(var q in b)s(t(q,b[q]),a.a);else continue;c||(a.d=!0,a.f(a.a,b),a.d=!1)}}\n function p(a){return{set:function(b,c){s(t(b,c),a.a)},get:function(b){return a.get(b)}}}function t(a,b){for(var c={},d=c,e=a.split(&quot;.&quot;),f=0;f&lt;e.length-1;f++)d=d[e[f]]={};d[e[e.length-1]]=b;return c}function s(a,b){for(var c in a)if(k(a,c)){var d=a[c];&quot;array&quot;==h(d)?(&quot;array&quot;==h(b[c])||(b[c]=[]),s(d,b[c])):m(d)?(m(b[c])||(b[c]={}),s(d,b[c])):b[c]=d}};})();","name":"Library"}},"promotedSnippets":{"ef260e9aa3c673af240d17a2660480361a8e081d1ffeca2a5ed0e3219fc18567":{"code":"/**\n * Scope       : DOM Ready\n * Execution   : n/a\n * Condition   : n/a\n * Description : GTM Listener - Data Layer Helper Library (provided by Google), makes it easy to queue \n *               events. We use it here to process existing GTM Events for Collect\n * \n * Documentation: https://github.com/google/data-layer-helper\n * Source: https://raw.githubusercontent.com/google/data-layer-helper/master/dist/data-layer-helper.js\n *\n*/\n\n(function(){/*\n  jQuery v1.9.1 (c) 2005, 2012\n  jQuery Foundation, Inc. jquery.org/license.\n */\n var g=/\\[object (Boolean|Number|String|Function|Array|Date|RegExp)\\]/;function h(a){return null==a?String(a):(a=g.exec(Object.prototype.toString.call(Object(a))))?a[1].toLowerCase():&quot;object&quot;}function k(a,b){return Object.prototype.hasOwnProperty.call(Object(a),b)}function m(a){if(!a||&quot;object&quot;!=h(a)||a.nodeType||a==a.window)return!1;try{if(a.constructor&amp;&amp;!k(a,&quot;constructor&quot;)&amp;&amp;!k(a.constructor.prototype,&quot;isPrototypeOf&quot;))return!1}catch(b){return!1}for(var c in a);return void 0===c||k(a,c)};/*\n  Copyright 2012 Google Inc. All rights reserved. */\n function n(a,b,c){this.b=a;this.f=b||function(){};this.d=!1;this.a={};this.c=[];this.e=p(this);r(this,a,!c);var d=a.push,e=this;a.push=function(){var b=[].slice.call(arguments,0),c=d.apply(a,b);r(e,b);return c}}window.DataLayerHelper=n;n.prototype.get=function(a){var b=this.a;a=a.split(&quot;.&quot;);for(var c=0;c&lt;a.length;c++){if(void 0===b[a[c]])return;b=b[a[c]]}return b};n.prototype.flatten=function(){this.b.splice(0,this.b.length);this.b[0]={};s(this.a,this.b[0])};\n function r(a,b,c){for(a.c.push.apply(a.c,b);!1===a.d&amp;&amp;0&lt;a.c.length;){b=a.c.shift();if(&quot;array&quot;==h(b))a:{var d=b,e=a.a;if(&quot;string&quot;==h(d[0])){for(var f=d[0].split(&quot;.&quot;),u=f.pop(),d=d.slice(1),l=0;l&lt;f.length;l++){if(void 0===e[f[l]])break a;e=e[f[l]]}try{e[u].apply(e,d)}catch(v){}}}else if(&quot;function&quot;==typeof b)try{b.call(a.e)}catch(w){}else if(m(b))for(var q in b)s(t(q,b[q]),a.a);else continue;c||(a.d=!0,a.f(a.a,b),a.d=!1)}}\n function p(a){return{set:function(b,c){s(t(b,c),a.a)},get:function(b){return a.get(b)}}}function t(a,b){for(var c={},d=c,e=a.split(&quot;.&quot;),f=0;f&lt;e.length-1;f++)d=d[e[f]]={};d[e[e.length-1]]=b;return c}function s(a,b){for(var c in a)if(k(a,c)){var d=a[c];&quot;array&quot;==h(d)?(&quot;array&quot;==h(b[c])||(b[c]=[]),s(d,b[c])):m(d)?(m(b[c])||(b[c]={}),s(d,b[c])):b[c]=d}};})();","name":"dev","promotedDraftName":"Library","promotedTimestamp":"201910101225","promotedBy":"caleb.jaquith@tealium.com"},"6754af9632a2745e85c293e5aac0863370d9bd3330b9938c00cadfd215227d77":{"promotedBy":"caleb.jaquith@tealium.com","promotedTimestamp":"201906211317","promotedDraftName":"Library","name":"prod","code":"/**\n * Scope       : DOM Ready\n * Execution   : n/a\n * Condition   : n/a\n * Description : GTM Listener - Data Layer Helper Library (provided by Google), makes it easy to queue \n *               events. We use it here to process existing GTM Events for Collect\n * \n * Documentation: https://github.com/google/data-layer-helper\n * Source: https://raw.githubusercontent.com/google/data-layer-helper/master/dist/data-layer-helper.js\n *\n*/\n\n(function(){/*\n  jQuery v1.9.1 (c) 2005, 2012\n  jQuery Foundation, Inc. jquery.org/license.\n */\n var g=/\\[object (Boolean|Number|String|Function|Array|Date|RegExp)\\]/;function h(a){return null==a?String(a):(a=g.exec(Object.prototype.toString.call(Object(a))))?a[1].toLowerCase():&quot;object&quot;}function k(a,b){return Object.prototype.hasOwnProperty.call(Object(a),b)}function m(a){if(!a||&quot;object&quot;!=h(a)||a.nodeType||a==a.window)return!1;try{if(a.constructor&amp;&amp;!k(a,&quot;constructor&quot;)&amp;&amp;!k(a.constructor.prototype,&quot;isPrototypeOf&quot;))return!1}catch(b){return!1}for(var c in a);return void 0===c||k(a,c)};/*\n  Copyright 2012 Google Inc. All rights reserved. */\n function n(a,b,c){this.b=a;this.f=b||function(){};this.d=!1;this.a={};this.c=[];this.e=p(this);r(this,a,!c);var d=a.push,e=this;a.push=function(){var b=[].slice.call(arguments,0),c=d.apply(a,b);r(e,b);return c}}window.DataLayerHelper=n;n.prototype.get=function(a){var b=this.a;a=a.split(&quot;.&quot;);for(var c=0;c&lt;a.length;c++){if(void 0===b[a[c]])return;b=b[a[c]]}return b};n.prototype.flatten=function(){this.b.splice(0,this.b.length);this.b[0]={};s(this.a,this.b[0])};\n function r(a,b,c){for(a.c.push.apply(a.c,b);!1===a.d&amp;&amp;0&lt;a.c.length;){b=a.c.shift();if(&quot;array&quot;==h(b))a:{var d=b,e=a.a;if(&quot;string&quot;==h(d[0])){for(var f=d[0].split(&quot;.&quot;),u=f.pop(),d=d.slice(1),l=0;l&lt;f.length;l++){if(void 0===e[f[l]])break a;e=e[f[l]]}try{e[u].apply(e,d)}catch(v){}}}else if(&quot;function&quot;==typeof b)try{b.call(a.e)}catch(w){}else if(m(b))for(var q in b)s(t(q,b[q]),a.a);else continue;c||(a.d=!0,a.f(a.a,b),a.d=!1)}}\n function p(a){return{set:function(b,c){s(t(b,c),a.a)},get:function(b){return a.get(b)}}}function t(a,b){for(var c={},d=c,e=a.split(&quot;.&quot;),f=0;f&lt;e.length-1;f++)d=d[e[f]]={};d[e[e.length-1]]=b;return c}function s(a,b){for(var c in a)if(k(a,c)){var d=a[c];&quot;array&quot;==h(d)?(&quot;array&quot;==h(b[c])||(b[c]=[]),s(d,b[c])):m(d)?(m(b[c])||(b[c]={}),s(d,b[c])):b[c]=d}};})();"},"3f3ef786b34d6dd716e1812c8b74a7a0e1f05aa5f3230588f6f5bcd00c6c8392":{"promotedTimestamp":"201906211317","promotedDraftName":"Library","promotedBy":"caleb.jaquith@tealium.com","code":"/**\n * Scope       : DOM Ready\n * Execution   : n/a\n * Condition   : n/a\n * Description : GTM Listener - Data Layer Helper Library (provided by Google), makes it easy to queue \n *               events. We use it here to process existing GTM Events for Collect\n * \n * Documentation: https://github.com/google/data-layer-helper\n * Source: https://raw.githubusercontent.com/google/data-layer-helper/master/dist/data-layer-helper.js\n *\n*/\n\n(function(){/*\n  jQuery v1.9.1 (c) 2005, 2012\n  jQuery Foundation, Inc. jquery.org/license.\n */\n var g=/\\[object (Boolean|Number|String|Function|Array|Date|RegExp)\\]/;function h(a){return null==a?String(a):(a=g.exec(Object.prototype.toString.call(Object(a))))?a[1].toLowerCase():&quot;object&quot;}function k(a,b){return Object.prototype.hasOwnProperty.call(Object(a),b)}function m(a){if(!a||&quot;object&quot;!=h(a)||a.nodeType||a==a.window)return!1;try{if(a.constructor&amp;&amp;!k(a,&quot;constructor&quot;)&amp;&amp;!k(a.constructor.prototype,&quot;isPrototypeOf&quot;))return!1}catch(b){return!1}for(var c in a);return void 0===c||k(a,c)};/*\n  Copyright 2012 Google Inc. All rights reserved. */\n function n(a,b,c){this.b=a;this.f=b||function(){};this.d=!1;this.a={};this.c=[];this.e=p(this);r(this,a,!c);var d=a.push,e=this;a.push=function(){var b=[].slice.call(arguments,0),c=d.apply(a,b);r(e,b);return c}}window.DataLayerHelper=n;n.prototype.get=function(a){var b=this.a;a=a.split(&quot;.&quot;);for(var c=0;c&lt;a.length;c++){if(void 0===b[a[c]])return;b=b[a[c]]}return b};n.prototype.flatten=function(){this.b.splice(0,this.b.length);this.b[0]={};s(this.a,this.b[0])};\n function r(a,b,c){for(a.c.push.apply(a.c,b);!1===a.d&amp;&amp;0&lt;a.c.length;){b=a.c.shift();if(&quot;array&quot;==h(b))a:{var d=b,e=a.a;if(&quot;string&quot;==h(d[0])){for(var f=d[0].split(&quot;.&quot;),u=f.pop(),d=d.slice(1),l=0;l&lt;f.length;l++){if(void 0===e[f[l]])break a;e=e[f[l]]}try{e[u].apply(e,d)}catch(v){}}}else if(&quot;function&quot;==typeof b)try{b.call(a.e)}catch(w){}else if(m(b))for(var q in b)s(t(q,b[q]),a.a);else continue;c||(a.d=!0,a.f(a.a,b),a.d=!1)}}\n function p(a){return{set:function(b,c){s(t(b,c),a.a)},get:function(b){return a.get(b)}}}function t(a,b){for(var c={},d=c,e=a.split(&quot;.&quot;),f=0;f&lt;e.length-1;f++)d=d[e[f]]={};d[e[e.length-1]]=b;return c}function s(a,b){for(var c in a)if(k(a,c)){var d=a[c];&quot;array&quot;==h(d)?(&quot;array&quot;==h(b[c])||(b[c]=[]),s(d,b[c])):m(d)?(m(b[c])||(b[c]={}),s(d,b[c])):b[c]=d}};})();","name":"qa"}},"draftSeq":"1"},"labels":"","initialize":"","advExecOption":"alr","scope":"domready","constructor":"","status":"active","type":"new","publishedTargets":"dev","blockPubTargetsLogic":"true","selectedTargets":{"qa":"true","prod":"true","dev":"true"},"sort":"1","notes":"","extType":"Javascript Code","_id":"2"},"3":{"extType":"Javascript Code","_id":"3","selectedTargets":{"prod":"true","dev":"true","qa":"true"},"sort":"3","notes":"afdadfda","publishedTargets":"dev","blockPubTargetsLogic":"true","type":"new","advExecOption":"alr","constructor":"","scope":"domready","status":"active","labels":"","initialize":"","codeDevData":{"draftSeq":"0","promotedSnippets":{"ef260e9aa3c673af240d17a2660480361a8e081d1ffeca2a5ed0e3219fc18567":{"name":"dev","code":"/**\n * Scope       : DOM Ready\n * Execution   : n/a\n * Condition   : n/a\n * Description : GTM Listener - Add listener function using the DataLayer Helper\n */\n \n\nvar processEvent = function(model, message) {\n    // exit if the flattener function isn't present on the page\n    if (!teal || typeof teal.flattenObject !== &quot;function&quot;) {\n        return;\n    }\n    /**\n     * Process the model, once per page on (or after) DOM Load\n     */\n    var flat = {};\n    \n    // utag.view on GTM Load to help see dataLayer for now\n    if (message.event === &quot;gtm.load&quot;) {\n        //console.log(teal.flattenObject(message, message));\n        flat = teal.flattenObject(model, model);\n        flat.tealium_event = flat.page_type || flat.pageType || &quot;other-view&quot;;\n        console.log(&quot;++++ View / &quot;+ flat.tealium_event, flat);\n        utag.view(flat);\n    }\n    \n    // some click events as examples\n    if (message.event === &quot;ButtonClickEvent&quot; || message.event === &quot;GAevent&quot;) {\n        flat = teal.flattenObject(message, message);\n        flat.tealium_event = flat.event;\n        console.log(&quot;++++ Link / &quot; + flat.tealium_event, flat);\n        utag.link(flat);\n    }\n};\n\n// make sure the object is actually defined\nwindow.dataLayer = window.dataLayer || window.dataLayerKP || []; // cross-site compatibility, aroundhome uses dataLayerKP\n// since we're still using the legacy events, we start with a reformatting function \nif (typeof processEvent === &quot;function&quot;) {\n    var helper = new DataLayerHelper(window.dataLayer, processEvent, true);\n}","promotedBy":"caleb.jaquith@tealium.com","promotedDraftName":"Listener","promotedTimestamp":"202002110922"},"3f3ef786b34d6dd716e1812c8b74a7a0e1f05aa5f3230588f6f5bcd00c6c8392":{"name":"qa","code":"/**\n * Scope       : DOM Ready\n * Execution   : n/a\n * Condition   : n/a\n * Description : GTM Listener - Add listener function using the DataLayer Helper\n */\n \n\nvar processEvent = function(model, message) {\n    // exit if the flattener function isn't present on the page\n    if (!teal || typeof teal.flattenObject !== &quot;function&quot;) {\n        return;\n    }\n    /**\n     * Process the model, once per page on (or after) DOM Load\n     */\n    var flat = {};\n    \n    // utag.view on GTM Load to help see dataLayer for now\n    if (message.event === &quot;gtm.load&quot;) {\n        //console.log(teal.flattenObject(message, message));\n        flat = teal.flattenObject(model, model);\n        flat.tealium_event = flat.page_type || flat.pageType || &quot;other-view&quot;;\n        console.log(&quot;++++ View / &quot;+ flat.tealium_event, flat);\n        utag.view(flat);\n    }\n    \n    // some click events as examples\n    if (message.event === &quot;ButtonClickEvent&quot; || message.event === &quot;GAevent&quot;) {\n        flat = teal.flattenObject(message, message);\n        flat.tealium_event = flat.event;\n        console.log(&quot;++++ Link / &quot; + flat.tealium_event, flat);\n        utag.link(flat);\n    }\n};\n\n// make sure the object is actually defined\nwindow.dataLayer = window.dataLayer || window.dataLayerKP || []; // cross-site compatibility, aroundhome uses dataLayerKP\n// since we're still using the legacy events, we start with a reformatting function \nif (typeof processEvent === &quot;function&quot;) {\n    var helper = new DataLayerHelper(window.dataLayer, processEvent, true);\n}","promotedBy":"caleb.jaquith@tealium.com","promotedTimestamp":"202002110922","promotedDraftName":"Listener"},"6754af9632a2745e85c293e5aac0863370d9bd3330b9938c00cadfd215227d77":{"code":"/**\n * Scope       : DOM Ready\n * Execution   : n/a\n * Condition   : n/a\n * Description : GTM Listener - Add listener function using the DataLayer Helper\n */\n \n\nvar processEvent = function(model, message) {\n    // exit if the flattener function isn't present on the page\n    if (!teal || typeof teal.flattenObject !== &quot;function&quot;) {\n        return;\n    }\n    /**\n     * Process the model, once per page on (or after) DOM Load\n     */\n    var flat = {};\n    \n    // utag.view on GTM Load to help see dataLayer for now\n    if (message.event === &quot;gtm.load&quot;) {\n        //console.log(teal.flattenObject(message, message));\n        flat = teal.flattenObject(model, model);\n        flat.tealium_event = flat.page_type || flat.pageType || &quot;other-view&quot;;\n        console.log(&quot;++++ View / &quot;+ flat.tealium_event, flat);\n        utag.view(flat);\n    }\n    \n    // some click events as examples\n    if (message.event === &quot;ButtonClickEvent&quot; || message.event === &quot;GAevent&quot;) {\n        flat = teal.flattenObject(message, message);\n        flat.tealium_event = flat.event;\n        console.log(&quot;++++ Link / &quot; + flat.tealium_event, flat);\n        utag.link(flat);\n    }\n};\n\n// make sure the object is actually defined\nwindow.dataLayer = window.dataLayer || window.dataLayerKP || []; // cross-site compatibility, aroundhome uses dataLayerKP\n// since we're still using the legacy events, we start with a reformatting function \nif (typeof processEvent === &quot;function&quot;) {\n    var helper = new DataLayerHelper(window.dataLayer, processEvent, true);\n}","name":"prod","promotedDraftName":"Listener","promotedTimestamp":"202002110922","promotedBy":"caleb.jaquith@tealium.com"}},"queueSeq":"19","draftSnippets":{"82e6d189952d4df484b68fcf3dca63cb64d43d701598bfefa7a7a4183a14b163":{"updatedBy":"caleb.jaquith@tealium.com","updateDate":"202002110919","creationDate":"201906200719","name":"Listener","code":"/**\n * Scope       : DOM Ready\n * Execution   : n/a\n * Condition   : n/a\n * Description : GTM Listener - Add listener function using the DataLayer Helper\n */\n \n\nvar processEvent = function(model, message) {\n    // exit if the flattener function isn't present on the page\n    if (!teal || typeof teal.flattenObject !== &quot;function&quot;) {\n        return;\n    }\n    /**\n     * Process the model, once per page on (or after) DOM Load\n     */\n    var flat = {};\n    \n    // utag.view on GTM Load to help see dataLayer for now\n    if (message.event === &quot;gtm.load&quot;) {\n        //console.log(teal.flattenObject(message, message));\n        flat = teal.flattenObject(model, model);\n        flat.tealium_event = flat.page_type || flat.pageType || &quot;other-view&quot;;\n        console.log(&quot;++++ View / &quot;+ flat.tealium_event, flat);\n        utag.view(flat);\n    }\n    \n    // some click events as examples\n    if (message.event === &quot;ButtonClickEvent&quot; || message.event === &quot;GAevent&quot;) {\n        flat = teal.flattenObject(message, message);\n        flat.tealium_event = flat.event;\n        console.log(&quot;++++ Link / &quot; + flat.tealium_event, flat);\n        utag.link(flat);\n    }\n};\n\n// make sure the object is actually defined\nwindow.dataLayer = window.dataLayer || window.dataLayerKP || []; // cross-site compatibility, aroundhome uses dataLayerKP\n// since we're still using the legacy events, we start with a reformatting function \nif (typeof processEvent === &quot;function&quot;) {\n    var helper = new DataLayerHelper(window.dataLayer, processEvent, true);\n}"}}},"id":"100040","title":"GTM Listener (4/4) - Data Layer Listener Function"},"4":{"blockPubTargetsLogic":"true","publishedTargets":"dev","type":"new","_id":"4","extType":"Javascript Code","notes":"","sort":"0","selectedTargets":{"qa":"true","prod":"true","dev":"true"},"title":"GTM Listener (1/4) - Disable automatic utag.view call","id":"100040","status":"active","scope":"preload","constructor":"","advExecOption":"alr","labels":"","initialize":"","codeDevData":{"queueSeq":"2","draftSnippets":{"156e808776455eb7fb3231a67b22d1d38ab0ed941db5b8d157735eea6c9da88b":{"creationDate":"201906200726","updateDate":"201906200731","updatedBy":"caleb.jaquith@tealium.com","code":"// Preloader\n\n// disable the automatic view, we want to fire it from the listener instead\nwindow.utag_cfg_ovrd = window.utag_cfg_ovrd || {};\nwindow.utag_cfg_ovrd.noview = true;","name":"Draft 1"}},"promotedSnippets":{"ef260e9aa3c673af240d17a2660480361a8e081d1ffeca2a5ed0e3219fc18567":{"promotedDraftName":"Draft 1","promotedTimestamp":"201906211317","promotedBy":"caleb.jaquith@tealium.com","code":"// Preloader\n\n// disable the automatic view, we want to fire it from the listener instead\nwindow.utag_cfg_ovrd = window.utag_cfg_ovrd || {};\nwindow.utag_cfg_ovrd.noview = true;","name":"dev"},"3f3ef786b34d6dd716e1812c8b74a7a0e1f05aa5f3230588f6f5bcd00c6c8392":{"name":"qa","code":"// Preloader\n\n// disable the automatic view, we want to fire it from the listener instead\nwindow.utag_cfg_ovrd = window.utag_cfg_ovrd || {};\nwindow.utag_cfg_ovrd.noview = true;","promotedBy":"caleb.jaquith@tealium.com","promotedTimestamp":"201906211317","promotedDraftName":"Draft 1"},"6754af9632a2745e85c293e5aac0863370d9bd3330b9938c00cadfd215227d77":{"name":"prod","code":"// Preloader\n\n// disable the automatic view, we want to fire it from the listener instead\nwindow.utag_cfg_ovrd = window.utag_cfg_ovrd || {};\nwindow.utag_cfg_ovrd.noview = true;","promotedBy":"caleb.jaquith@tealium.com","promotedDraftName":"Draft 1","promotedTimestamp":"201906211317"}},"draftSeq":"1"}},"8":{"type":"new","blockPubTargetsLogic":"true","publishedTargets":"dev","notes":"","sort":"2","selectedTargets":{"prod":"true","dev":"true","qa":"true"},"_id":"8","extType":"Javascript Code","title":"GTM Listener (3/4) - Tealium Flattener Definitions","id":"100040","initialize":"","labels":"","codeDevData":{"draftSnippets":{"156e808776455eb7fb3231a67b22d1d38ab0ed941db5b8d157735eea6c9da88b":{"code":"// Flattener, pulled from https://tags.tiqcdn.com/utag/tealium-solutions/main/prod/utag.9.js as instructed by\n// https://community.tealiumiq.com/t5/iQ-Tag-Management/Data-Layer-Converter/ta-p/17581#toc-hId-1329378795\n\n//Define the teal global namespace\nwindow.teal = window.teal || {};\nteal.ignore_keys = {};\nteal.replace_keys = {};\nteal.prefix = &quot;&quot;;\n\n//In cases of a nested object, what should join the parent key and child key\nteal.nested_delimiter = &quot;.&quot;;\n\n//Ignore keys in the data layer that start with the following text.\n//Expecting an object of strings\n/*\nteal.ignore_keys = {\n  &quot;user&quot; : 1,\n  &quot;util&quot; : 1\n};\n*/\n\n//Specify a prefix for data layer elements being sent to the utag_data object.\n//Instead of utag_data.productID, it could be utag_data.dl_productID\n// teal.prefix = &quot;dl_&quot;;\n\n//Keys to be removed from the new flattened key name\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.page.pi.pageName\n/* teal.replace_keys = {\n    &quot;pageInfo&quot;:&quot;pi&quot;\n  };\n*/\n\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.page.pageName\n/* teal.replace_keys = {\n    &quot;pageInfo&quot;:&quot;&quot;\n  };\n*/\n\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.pageName\n/* teal.replace_keys = {\n    &quot;page&quot;:&quot;&quot;,\n    &quot;pageInfo&quot;:&quot;&quot;\n  };\n*/\n\n/*****************DO NOT MODIFY BELOW***********************/\n\nteal.flattener_version = 1.4;\n\n// From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys\n// Add the Object.keys method for older versions of IE\nObject.keys||(Object.keys=function(){&quot;use strict&quot;;var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable(&quot;toString&quot;),c=[&quot;toString&quot;,&quot;toLocaleString&quot;,&quot;valueOf&quot;,&quot;hasOwnProperty&quot;,&quot;isPrototypeOf&quot;,&quot;propertyIsEnumerable&quot;,&quot;constructor&quot;],d=c.length;return function(e){if(&quot;object&quot;!=typeof e&amp;&amp;(&quot;function&quot;!=typeof e||null===e))throw new TypeError(&quot;Object.keys called on non-object&quot;);var g,h,f=[];for(g in e)a.call(e,g)&amp;&amp;f.push(g);if(b)for(h=0;h&lt;d;h++)a.call(e,c[h])&amp;&amp;f.push(c[h]);return f}}());\n\nteal.ignoreKey = function(key,re){\n  var should_ignore_key = 0;\n  //Build a new array to avoid running through Object.keys multiple times\n  if(typeof teal.ignore_keys_list === 'undefined'){\n    teal.ignore_keys_list = Object.keys(teal.ignore_keys);\n    teal.ignore_keys_list.forEach(function(name){\n      //Store a copy of the regex in the object\n      teal.ignore_keys[name] = new RegExp(&quot;^&quot;+name);\n      if(key.match(teal.ignore_keys[name])){\n        should_ignore_key = 1;\n      }\n    });\n  }else{\n    //Loop through the ignore_keys object to see if we should ignore this key\n    teal.ignore_keys_list.forEach(function(name){\n      if(key.match(teal.ignore_keys[name])){\n        should_ignore_key = 1;\n      }\n    });\n  }\n  return should_ignore_key;\n}\n\nteal.getKeyName = function(key,re){\n  //Create a new object to store regexs or use existing one\n  teal.replace_keys_regex = teal.replace_keys_regex || {};\n  //Build a new array to avoid running through Object.keys multiple times\n  if(typeof teal.replace_keys_list === 'undefined'){\n    teal.replace_keys_list = Object.keys(teal.replace_keys);\n    //Make a start of string and end of string regex\n    teal.replace_keys_regex.startOfString = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n    teal.replace_keys_regex.endOfString = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]$&quot;);\n    teal.replace_keys_list.forEach(function(name){\n      //Store a copy of the regex in the teal.replace_keys_regex object so that the regexs are only built once\n      teal.replace_keys_regex[name] = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]?&quot; + name + &quot;[&quot; + teal.nested_delimiter + &quot;]?&quot;, &quot;g&quot;);\n      key = teal.keyReplace(key,name,teal.replace_keys_regex[name]);\n    });\n  }else{\n    //Loop through the replace_keys object to see what we should be replacing\n    teal.replace_keys_list.forEach(function(name){\n      key = teal.keyReplace(key,name,teal.replace_keys_regex[name]);\n    });\n  }\n  return key;\n}\n\nteal.keyReplace = function(key,name,re){\n  //Check to see if we are replacing the key name with a new value or if we are removing the key altogether\n  if(teal.replace_keys[name] === ''){\n    //The key needs to be removed completely\n    key = key.replace(re,teal.nested_delimiter);\n    //Check to see if the key starts with the nested delimiter and if so, remove it\n    if(key.indexOf(teal.nested_delimiter) === 0){\n      var cleanRegEx = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n  }else{\n    //Make a copy of the original key to see how we need to update the key name\n    var origKey = key;\n    //Replace the key name\n    key = key.replace(re,teal.nested_delimiter + teal.replace_keys[name] + teal.nested_delimiter);\n    //Check for the start of the origKey to see of the nested delimiter is there\n    if(!origKey.match(teal.replace_keys_regex.startOfString)){\n      //Remove the nested delimiter from the start of the string\n      var cleanRegEx = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n    //Check for the end of the origKey to see of the nested delimiter is there\n    if(!origKey.match(teal.replace_keys_regex.endOfString)){\n      //Add the nested delimiter to the end of the string\n      var cleanRegEx = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]$&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n  }\n  return key;\n}\n\nteal.processDataObject = function(obj,new_obj,parent_key,create_array){\n  if(typeof parent_key === &quot;undefined&quot;){\n    //This object isn't nested in another object\n    parent_key = &quot;&quot;;\n  }else{\n    //Add the nested_delimiter to the parent key if the delimiter isn't already at the end\n    teal.nested_delimiter_regex = teal.nested_delimiter_regex || new RegExp(&quot;[&quot;+teal.nested_delimiter+&quot;]$&quot;);\n    if(!parent_key.match(teal.nested_delimiter_regex)){\n      parent_key += &quot;&quot;+teal.nested_delimiter;\n    }\n  }\n  Object.keys(obj).forEach(function(key){\n    var nested_key_name = parent_key+key;\n    //Format the new key name and take out any whitespace\n    var new_key_name = teal.getKeyName((teal.prefix+parent_key+key).replace(/\\s/g, ''));\n    //Set the key_type to limit the number of typeof checks\n    var key_type = teal.typeOf(obj[key]);\n    if(key_type !== 'undefined' &amp;&amp; key_type != null){\n      if(key_type.match(/boolean|string|number|date/) &amp;&amp; !teal.ignoreKey(key)){\n        //If obj[key] is a date, convert to ISOString\n        if(teal.typeOf(obj[key]) === 'date'){\n          obj[key] = obj[key].toISOString();\n        }\n        //Check to see if we need to create an array for this data point\n        if(create_array){\n          //First check to see if this key exists\n          if(teal.typeOf(new_obj[new_key_name]) !== &quot;array&quot;){\n            //Make the key an array                       \n            new_obj[new_key_name] = [];\n          }\n          new_obj[new_key_name].push(&quot;&quot;+obj[key]); //Force value to be a string\n        }else{\n          //If the value of the key is a boolean or a string or a number and \n          //the key shouldn't be ignored add to the data layer\n          new_obj[new_key_name] = &quot;&quot;+obj[key]; //Force value to be a string\n        }\n      }else if(key_type === 'object' &amp;&amp; !teal.ignoreKey(key)){\n        //Process this piece of the data layer and merge it\n        teal.processDataObject(obj[key],new_obj,nested_key_name,create_array);\n      }else if(key_type === 'array'){\n        teal.processDataArray(obj[key],new_obj,nested_key_name);\n      }\n    }\n  });\n}\n\nteal.processDataArray = function(obj,new_obj,parent_key){\n  var objLength = obj.length; \n  if(typeof parent_key === &quot;undefined&quot;){\n    //This object isn't nested in another object\n    parent_key = &quot;&quot;;\n  }else if(objLength &gt; 0 &amp;&amp; teal.typeOf(obj[0]).match(/boolean|string|number|date/)){\n    //This is a normal array that doesn't need a nested delimiter\n  }else{\n    //Add the nested_delimiter to the parent key\n    parent_key += &quot;&quot;+teal.nested_delimiter;\n  }\n  //Format the new key name and take out any whitespace\n  var new_key_name = teal.getKeyName((teal.prefix+parent_key).replace(/\\s/g, ''));\n  for(var n = 0; n &lt; objLength; n++){\n    var key_type = teal.typeOf(obj[n]);\n    if(key_type.match(/boolean|string|number|date/)){\n      //If obj[n] is a date, convert to ISOString\n      if(key_type === 'date'){\n        obj[n] = obj[n].toISOString();\n      }\n      //First check to see if this key exists\n      if(teal.typeOf(new_obj[new_key_name]) !== &quot;array&quot;){\n        //Make the key an array                       \n        new_obj[new_key_name] = [];\n      }\n      //If the value of the key is a boolean or a string or a number and \n      //the key shouldn't be ignored add to the data layer                        \n      new_obj[new_key_name].push(&quot;&quot;+obj[n]);\n    }else if(key_type === 'object'){\n      teal.processDataObject(obj[n],new_obj,new_key_name,1);\n    }\n  }\n}\n\nteal.typeOf = function(e){return ({}).toString.call(e).match(/\\s([a-zA-Z]+)/)[1].toLowerCase();}\n\nteal.flattenObject = function(obj,new_obj){\n  //Make sure object exists\n  if(typeof obj === 'undefined'){\n    return false;\n  }\n  //Check to see if we want to flatten the same object and keep the reference\n  var mergeObject = false;\n  if(obj === new_obj){\n    mergeObject = true;\n    //Start off a clean copy of the object\n    new_obj = {};\n  }\n  //Make sure new object exists\n  if(typeof new_obj === 'undefined'){\n    new_obj = {};\n  }\n  //Check to see if this object is an array\n  if(teal.typeOf(obj) === 'array'){\n    //Store a safe copy of this object in case we are processing the b object\n    var temp_array = JSON.parse(JSON.stringify(obj));\n    var temp_array_length = temp_array.length;\n    //Clean up the object\n    obj = {};\n    //Let's see if the obj and new_obj are the same.  If so, going to assume we are using the b object\n    if(obj == new_obj){\n      //Let's ensure that we have the a object\n      if(typeof a === 'undefined'){\n        var a = 'view';\n      }\n      //Add the automatic utag data points\n      utag.loader.RD(new_obj,a);\n    }\n    for(var i = 0; i &lt; temp_array_length; i++){\n        teal.processDataObject(temp_array[i],new_obj);\n    }\n  }else{\n    teal.processDataObject(obj,new_obj);\n  }\n  if(mergeObject){\n    //Need to delete everything out of obj and replace with new_obj\n    Object.keys(obj).forEach(function(key){\n      delete obj[key];\n    });\n    //Now that we have a clean original object, add everything from new_obj which allows the reference to be kept\n    Object.keys(new_obj).forEach(function(key){\n      obj[key] = new_obj[key];\n    });\n  }\n\n  return new_obj;\n}","name":"Draft 1","creationDate":"201906211315","updateDate":"201906211315","updatedBy":"caleb.jaquith@tealium.com"}},"queueSeq":"2","promotedSnippets":{"ef260e9aa3c673af240d17a2660480361a8e081d1ffeca2a5ed0e3219fc18567":{"code":"// Flattener, pulled from https://tags.tiqcdn.com/utag/tealium-solutions/main/prod/utag.9.js as instructed by\n// https://community.tealiumiq.com/t5/iQ-Tag-Management/Data-Layer-Converter/ta-p/17581#toc-hId-1329378795\n\n//Define the teal global namespace\nwindow.teal = window.teal || {};\nteal.ignore_keys = {};\nteal.replace_keys = {};\nteal.prefix = &quot;&quot;;\n\n//In cases of a nested object, what should join the parent key and child key\nteal.nested_delimiter = &quot;.&quot;;\n\n//Ignore keys in the data layer that start with the following text.\n//Expecting an object of strings\n/*\nteal.ignore_keys = {\n  &quot;user&quot; : 1,\n  &quot;util&quot; : 1\n};\n*/\n\n//Specify a prefix for data layer elements being sent to the utag_data object.\n//Instead of utag_data.productID, it could be utag_data.dl_productID\n// teal.prefix = &quot;dl_&quot;;\n\n//Keys to be removed from the new flattened key name\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.page.pi.pageName\n/* teal.replace_keys = {\n    &quot;pageInfo&quot;:&quot;pi&quot;\n  };\n*/\n\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.page.pageName\n/* teal.replace_keys = {\n    &quot;pageInfo&quot;:&quot;&quot;\n  };\n*/\n\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.pageName\n/* teal.replace_keys = {\n    &quot;page&quot;:&quot;&quot;,\n    &quot;pageInfo&quot;:&quot;&quot;\n  };\n*/\n\n/*****************DO NOT MODIFY BELOW***********************/\n\nteal.flattener_version = 1.4;\n\n// From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys\n// Add the Object.keys method for older versions of IE\nObject.keys||(Object.keys=function(){&quot;use strict&quot;;var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable(&quot;toString&quot;),c=[&quot;toString&quot;,&quot;toLocaleString&quot;,&quot;valueOf&quot;,&quot;hasOwnProperty&quot;,&quot;isPrototypeOf&quot;,&quot;propertyIsEnumerable&quot;,&quot;constructor&quot;],d=c.length;return function(e){if(&quot;object&quot;!=typeof e&amp;&amp;(&quot;function&quot;!=typeof e||null===e))throw new TypeError(&quot;Object.keys called on non-object&quot;);var g,h,f=[];for(g in e)a.call(e,g)&amp;&amp;f.push(g);if(b)for(h=0;h&lt;d;h++)a.call(e,c[h])&amp;&amp;f.push(c[h]);return f}}());\n\nteal.ignoreKey = function(key,re){\n  var should_ignore_key = 0;\n  //Build a new array to avoid running through Object.keys multiple times\n  if(typeof teal.ignore_keys_list === 'undefined'){\n    teal.ignore_keys_list = Object.keys(teal.ignore_keys);\n    teal.ignore_keys_list.forEach(function(name){\n      //Store a copy of the regex in the object\n      teal.ignore_keys[name] = new RegExp(&quot;^&quot;+name);\n      if(key.match(teal.ignore_keys[name])){\n        should_ignore_key = 1;\n      }\n    });\n  }else{\n    //Loop through the ignore_keys object to see if we should ignore this key\n    teal.ignore_keys_list.forEach(function(name){\n      if(key.match(teal.ignore_keys[name])){\n        should_ignore_key = 1;\n      }\n    });\n  }\n  return should_ignore_key;\n}\n\nteal.getKeyName = function(key,re){\n  //Create a new object to store regexs or use existing one\n  teal.replace_keys_regex = teal.replace_keys_regex || {};\n  //Build a new array to avoid running through Object.keys multiple times\n  if(typeof teal.replace_keys_list === 'undefined'){\n    teal.replace_keys_list = Object.keys(teal.replace_keys);\n    //Make a start of string and end of string regex\n    teal.replace_keys_regex.startOfString = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n    teal.replace_keys_regex.endOfString = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]$&quot;);\n    teal.replace_keys_list.forEach(function(name){\n      //Store a copy of the regex in the teal.replace_keys_regex object so that the regexs are only built once\n      teal.replace_keys_regex[name] = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]?&quot; + name + &quot;[&quot; + teal.nested_delimiter + &quot;]?&quot;, &quot;g&quot;);\n      key = teal.keyReplace(key,name,teal.replace_keys_regex[name]);\n    });\n  }else{\n    //Loop through the replace_keys object to see what we should be replacing\n    teal.replace_keys_list.forEach(function(name){\n      key = teal.keyReplace(key,name,teal.replace_keys_regex[name]);\n    });\n  }\n  return key;\n}\n\nteal.keyReplace = function(key,name,re){\n  //Check to see if we are replacing the key name with a new value or if we are removing the key altogether\n  if(teal.replace_keys[name] === ''){\n    //The key needs to be removed completely\n    key = key.replace(re,teal.nested_delimiter);\n    //Check to see if the key starts with the nested delimiter and if so, remove it\n    if(key.indexOf(teal.nested_delimiter) === 0){\n      var cleanRegEx = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n  }else{\n    //Make a copy of the original key to see how we need to update the key name\n    var origKey = key;\n    //Replace the key name\n    key = key.replace(re,teal.nested_delimiter + teal.replace_keys[name] + teal.nested_delimiter);\n    //Check for the start of the origKey to see of the nested delimiter is there\n    if(!origKey.match(teal.replace_keys_regex.startOfString)){\n      //Remove the nested delimiter from the start of the string\n      var cleanRegEx = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n    //Check for the end of the origKey to see of the nested delimiter is there\n    if(!origKey.match(teal.replace_keys_regex.endOfString)){\n      //Add the nested delimiter to the end of the string\n      var cleanRegEx = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]$&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n  }\n  return key;\n}\n\nteal.processDataObject = function(obj,new_obj,parent_key,create_array){\n  if(typeof parent_key === &quot;undefined&quot;){\n    //This object isn't nested in another object\n    parent_key = &quot;&quot;;\n  }else{\n    //Add the nested_delimiter to the parent key if the delimiter isn't already at the end\n    teal.nested_delimiter_regex = teal.nested_delimiter_regex || new RegExp(&quot;[&quot;+teal.nested_delimiter+&quot;]$&quot;);\n    if(!parent_key.match(teal.nested_delimiter_regex)){\n      parent_key += &quot;&quot;+teal.nested_delimiter;\n    }\n  }\n  Object.keys(obj).forEach(function(key){\n    var nested_key_name = parent_key+key;\n    //Format the new key name and take out any whitespace\n    var new_key_name = teal.getKeyName((teal.prefix+parent_key+key).replace(/\\s/g, ''));\n    //Set the key_type to limit the number of typeof checks\n    var key_type = teal.typeOf(obj[key]);\n    if(key_type !== 'undefined' &amp;&amp; key_type != null){\n      if(key_type.match(/boolean|string|number|date/) &amp;&amp; !teal.ignoreKey(key)){\n        //If obj[key] is a date, convert to ISOString\n        if(teal.typeOf(obj[key]) === 'date'){\n          obj[key] = obj[key].toISOString();\n        }\n        //Check to see if we need to create an array for this data point\n        if(create_array){\n          //First check to see if this key exists\n          if(teal.typeOf(new_obj[new_key_name]) !== &quot;array&quot;){\n            //Make the key an array                       \n            new_obj[new_key_name] = [];\n          }\n          new_obj[new_key_name].push(&quot;&quot;+obj[key]); //Force value to be a string\n        }else{\n          //If the value of the key is a boolean or a string or a number and \n          //the key shouldn't be ignored add to the data layer\n          new_obj[new_key_name] = &quot;&quot;+obj[key]; //Force value to be a string\n        }\n      }else if(key_type === 'object' &amp;&amp; !teal.ignoreKey(key)){\n        //Process this piece of the data layer and merge it\n        teal.processDataObject(obj[key],new_obj,nested_key_name,create_array);\n      }else if(key_type === 'array'){\n        teal.processDataArray(obj[key],new_obj,nested_key_name);\n      }\n    }\n  });\n}\n\nteal.processDataArray = function(obj,new_obj,parent_key){\n  var objLength = obj.length; \n  if(typeof parent_key === &quot;undefined&quot;){\n    //This object isn't nested in another object\n    parent_key = &quot;&quot;;\n  }else if(objLength &gt; 0 &amp;&amp; teal.typeOf(obj[0]).match(/boolean|string|number|date/)){\n    //This is a normal array that doesn't need a nested delimiter\n  }else{\n    //Add the nested_delimiter to the parent key\n    parent_key += &quot;&quot;+teal.nested_delimiter;\n  }\n  //Format the new key name and take out any whitespace\n  var new_key_name = teal.getKeyName((teal.prefix+parent_key).replace(/\\s/g, ''));\n  for(var n = 0; n &lt; objLength; n++){\n    var key_type = teal.typeOf(obj[n]);\n    if(key_type.match(/boolean|string|number|date/)){\n      //If obj[n] is a date, convert to ISOString\n      if(key_type === 'date'){\n        obj[n] = obj[n].toISOString();\n      }\n      //First check to see if this key exists\n      if(teal.typeOf(new_obj[new_key_name]) !== &quot;array&quot;){\n        //Make the key an array                       \n        new_obj[new_key_name] = [];\n      }\n      //If the value of the key is a boolean or a string or a number and \n      //the key shouldn't be ignored add to the data layer                        \n      new_obj[new_key_name].push(&quot;&quot;+obj[n]);\n    }else if(key_type === 'object'){\n      teal.processDataObject(obj[n],new_obj,new_key_name,1);\n    }\n  }\n}\n\nteal.typeOf = function(e){return ({}).toString.call(e).match(/\\s([a-zA-Z]+)/)[1].toLowerCase();}\n\nteal.flattenObject = function(obj,new_obj){\n  //Make sure object exists\n  if(typeof obj === 'undefined'){\n    return false;\n  }\n  //Check to see if we want to flatten the same object and keep the reference\n  var mergeObject = false;\n  if(obj === new_obj){\n    mergeObject = true;\n    //Start off a clean copy of the object\n    new_obj = {};\n  }\n  //Make sure new object exists\n  if(typeof new_obj === 'undefined'){\n    new_obj = {};\n  }\n  //Check to see if this object is an array\n  if(teal.typeOf(obj) === 'array'){\n    //Store a safe copy of this object in case we are processing the b object\n    var temp_array = JSON.parse(JSON.stringify(obj));\n    var temp_array_length = temp_array.length;\n    //Clean up the object\n    obj = {};\n    //Let's see if the obj and new_obj are the same.  If so, going to assume we are using the b object\n    if(obj == new_obj){\n      //Let's ensure that we have the a object\n      if(typeof a === 'undefined'){\n        var a = 'view';\n      }\n      //Add the automatic utag data points\n      utag.loader.RD(new_obj,a);\n    }\n    for(var i = 0; i &lt; temp_array_length; i++){\n        teal.processDataObject(temp_array[i],new_obj);\n    }\n  }else{\n    teal.processDataObject(obj,new_obj);\n  }\n  if(mergeObject){\n    //Need to delete everything out of obj and replace with new_obj\n    Object.keys(obj).forEach(function(key){\n      delete obj[key];\n    });\n    //Now that we have a clean original object, add everything from new_obj which allows the reference to be kept\n    Object.keys(new_obj).forEach(function(key){\n      obj[key] = new_obj[key];\n    });\n  }\n\n  return new_obj;\n}","name":"dev","promotedDraftName":"Draft 1","promotedTimestamp":"201910101225","promotedBy":"caleb.jaquith@tealium.com"},"6754af9632a2745e85c293e5aac0863370d9bd3330b9938c00cadfd215227d77":{"promotedBy":"caleb.jaquith@tealium.com","promotedTimestamp":"201906211317","promotedDraftName":"Draft 1","name":"prod","code":"// Flattener, pulled from https://tags.tiqcdn.com/utag/tealium-solutions/main/prod/utag.9.js as instructed by\n// https://community.tealiumiq.com/t5/iQ-Tag-Management/Data-Layer-Converter/ta-p/17581#toc-hId-1329378795\n\n//Define the teal global namespace\nwindow.teal = window.teal || {};\nteal.ignore_keys = {};\nteal.replace_keys = {};\nteal.prefix = &quot;&quot;;\n\n//In cases of a nested object, what should join the parent key and child key\nteal.nested_delimiter = &quot;.&quot;;\n\n//Ignore keys in the data layer that start with the following text.\n//Expecting an object of strings\n/*\nteal.ignore_keys = {\n  &quot;user&quot; : 1,\n  &quot;util&quot; : 1\n};\n*/\n\n//Specify a prefix for data layer elements being sent to the utag_data object.\n//Instead of utag_data.productID, it could be utag_data.dl_productID\n// teal.prefix = &quot;dl_&quot;;\n\n//Keys to be removed from the new flattened key name\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.page.pi.pageName\n/* teal.replace_keys = {\n    &quot;pageInfo&quot;:&quot;pi&quot;\n  };\n*/\n\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.page.pageName\n/* teal.replace_keys = {\n    &quot;pageInfo&quot;:&quot;&quot;\n  };\n*/\n\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.pageName\n/* teal.replace_keys = {\n    &quot;page&quot;:&quot;&quot;,\n    &quot;pageInfo&quot;:&quot;&quot;\n  };\n*/\n\n/*****************DO NOT MODIFY BELOW***********************/\n\nteal.flattener_version = 1.4;\n\n// From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys\n// Add the Object.keys method for older versions of IE\nObject.keys||(Object.keys=function(){&quot;use strict&quot;;var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable(&quot;toString&quot;),c=[&quot;toString&quot;,&quot;toLocaleString&quot;,&quot;valueOf&quot;,&quot;hasOwnProperty&quot;,&quot;isPrototypeOf&quot;,&quot;propertyIsEnumerable&quot;,&quot;constructor&quot;],d=c.length;return function(e){if(&quot;object&quot;!=typeof e&amp;&amp;(&quot;function&quot;!=typeof e||null===e))throw new TypeError(&quot;Object.keys called on non-object&quot;);var g,h,f=[];for(g in e)a.call(e,g)&amp;&amp;f.push(g);if(b)for(h=0;h&lt;d;h++)a.call(e,c[h])&amp;&amp;f.push(c[h]);return f}}());\n\nteal.ignoreKey = function(key,re){\n  var should_ignore_key = 0;\n  //Build a new array to avoid running through Object.keys multiple times\n  if(typeof teal.ignore_keys_list === 'undefined'){\n    teal.ignore_keys_list = Object.keys(teal.ignore_keys);\n    teal.ignore_keys_list.forEach(function(name){\n      //Store a copy of the regex in the object\n      teal.ignore_keys[name] = new RegExp(&quot;^&quot;+name);\n      if(key.match(teal.ignore_keys[name])){\n        should_ignore_key = 1;\n      }\n    });\n  }else{\n    //Loop through the ignore_keys object to see if we should ignore this key\n    teal.ignore_keys_list.forEach(function(name){\n      if(key.match(teal.ignore_keys[name])){\n        should_ignore_key = 1;\n      }\n    });\n  }\n  return should_ignore_key;\n}\n\nteal.getKeyName = function(key,re){\n  //Create a new object to store regexs or use existing one\n  teal.replace_keys_regex = teal.replace_keys_regex || {};\n  //Build a new array to avoid running through Object.keys multiple times\n  if(typeof teal.replace_keys_list === 'undefined'){\n    teal.replace_keys_list = Object.keys(teal.replace_keys);\n    //Make a start of string and end of string regex\n    teal.replace_keys_regex.startOfString = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n    teal.replace_keys_regex.endOfString = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]$&quot;);\n    teal.replace_keys_list.forEach(function(name){\n      //Store a copy of the regex in the teal.replace_keys_regex object so that the regexs are only built once\n      teal.replace_keys_regex[name] = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]?&quot; + name + &quot;[&quot; + teal.nested_delimiter + &quot;]?&quot;, &quot;g&quot;);\n      key = teal.keyReplace(key,name,teal.replace_keys_regex[name]);\n    });\n  }else{\n    //Loop through the replace_keys object to see what we should be replacing\n    teal.replace_keys_list.forEach(function(name){\n      key = teal.keyReplace(key,name,teal.replace_keys_regex[name]);\n    });\n  }\n  return key;\n}\n\nteal.keyReplace = function(key,name,re){\n  //Check to see if we are replacing the key name with a new value or if we are removing the key altogether\n  if(teal.replace_keys[name] === ''){\n    //The key needs to be removed completely\n    key = key.replace(re,teal.nested_delimiter);\n    //Check to see if the key starts with the nested delimiter and if so, remove it\n    if(key.indexOf(teal.nested_delimiter) === 0){\n      var cleanRegEx = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n  }else{\n    //Make a copy of the original key to see how we need to update the key name\n    var origKey = key;\n    //Replace the key name\n    key = key.replace(re,teal.nested_delimiter + teal.replace_keys[name] + teal.nested_delimiter);\n    //Check for the start of the origKey to see of the nested delimiter is there\n    if(!origKey.match(teal.replace_keys_regex.startOfString)){\n      //Remove the nested delimiter from the start of the string\n      var cleanRegEx = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n    //Check for the end of the origKey to see of the nested delimiter is there\n    if(!origKey.match(teal.replace_keys_regex.endOfString)){\n      //Add the nested delimiter to the end of the string\n      var cleanRegEx = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]$&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n  }\n  return key;\n}\n\nteal.processDataObject = function(obj,new_obj,parent_key,create_array){\n  if(typeof parent_key === &quot;undefined&quot;){\n    //This object isn't nested in another object\n    parent_key = &quot;&quot;;\n  }else{\n    //Add the nested_delimiter to the parent key if the delimiter isn't already at the end\n    teal.nested_delimiter_regex = teal.nested_delimiter_regex || new RegExp(&quot;[&quot;+teal.nested_delimiter+&quot;]$&quot;);\n    if(!parent_key.match(teal.nested_delimiter_regex)){\n      parent_key += &quot;&quot;+teal.nested_delimiter;\n    }\n  }\n  Object.keys(obj).forEach(function(key){\n    var nested_key_name = parent_key+key;\n    //Format the new key name and take out any whitespace\n    var new_key_name = teal.getKeyName((teal.prefix+parent_key+key).replace(/\\s/g, ''));\n    //Set the key_type to limit the number of typeof checks\n    var key_type = teal.typeOf(obj[key]);\n    if(key_type !== 'undefined' &amp;&amp; key_type != null){\n      if(key_type.match(/boolean|string|number|date/) &amp;&amp; !teal.ignoreKey(key)){\n        //If obj[key] is a date, convert to ISOString\n        if(teal.typeOf(obj[key]) === 'date'){\n          obj[key] = obj[key].toISOString();\n        }\n        //Check to see if we need to create an array for this data point\n        if(create_array){\n          //First check to see if this key exists\n          if(teal.typeOf(new_obj[new_key_name]) !== &quot;array&quot;){\n            //Make the key an array                       \n            new_obj[new_key_name] = [];\n          }\n          new_obj[new_key_name].push(&quot;&quot;+obj[key]); //Force value to be a string\n        }else{\n          //If the value of the key is a boolean or a string or a number and \n          //the key shouldn't be ignored add to the data layer\n          new_obj[new_key_name] = &quot;&quot;+obj[key]; //Force value to be a string\n        }\n      }else if(key_type === 'object' &amp;&amp; !teal.ignoreKey(key)){\n        //Process this piece of the data layer and merge it\n        teal.processDataObject(obj[key],new_obj,nested_key_name,create_array);\n      }else if(key_type === 'array'){\n        teal.processDataArray(obj[key],new_obj,nested_key_name);\n      }\n    }\n  });\n}\n\nteal.processDataArray = function(obj,new_obj,parent_key){\n  var objLength = obj.length; \n  if(typeof parent_key === &quot;undefined&quot;){\n    //This object isn't nested in another object\n    parent_key = &quot;&quot;;\n  }else if(objLength &gt; 0 &amp;&amp; teal.typeOf(obj[0]).match(/boolean|string|number|date/)){\n    //This is a normal array that doesn't need a nested delimiter\n  }else{\n    //Add the nested_delimiter to the parent key\n    parent_key += &quot;&quot;+teal.nested_delimiter;\n  }\n  //Format the new key name and take out any whitespace\n  var new_key_name = teal.getKeyName((teal.prefix+parent_key).replace(/\\s/g, ''));\n  for(var n = 0; n &lt; objLength; n++){\n    var key_type = teal.typeOf(obj[n]);\n    if(key_type.match(/boolean|string|number|date/)){\n      //If obj[n] is a date, convert to ISOString\n      if(key_type === 'date'){\n        obj[n] = obj[n].toISOString();\n      }\n      //First check to see if this key exists\n      if(teal.typeOf(new_obj[new_key_name]) !== &quot;array&quot;){\n        //Make the key an array                       \n        new_obj[new_key_name] = [];\n      }\n      //If the value of the key is a boolean or a string or a number and \n      //the key shouldn't be ignored add to the data layer                        \n      new_obj[new_key_name].push(&quot;&quot;+obj[n]);\n    }else if(key_type === 'object'){\n      teal.processDataObject(obj[n],new_obj,new_key_name,1);\n    }\n  }\n}\n\nteal.typeOf = function(e){return ({}).toString.call(e).match(/\\s([a-zA-Z]+)/)[1].toLowerCase();}\n\nteal.flattenObject = function(obj,new_obj){\n  //Make sure object exists\n  if(typeof obj === 'undefined'){\n    return false;\n  }\n  //Check to see if we want to flatten the same object and keep the reference\n  var mergeObject = false;\n  if(obj === new_obj){\n    mergeObject = true;\n    //Start off a clean copy of the object\n    new_obj = {};\n  }\n  //Make sure new object exists\n  if(typeof new_obj === 'undefined'){\n    new_obj = {};\n  }\n  //Check to see if this object is an array\n  if(teal.typeOf(obj) === 'array'){\n    //Store a safe copy of this object in case we are processing the b object\n    var temp_array = JSON.parse(JSON.stringify(obj));\n    var temp_array_length = temp_array.length;\n    //Clean up the object\n    obj = {};\n    //Let's see if the obj and new_obj are the same.  If so, going to assume we are using the b object\n    if(obj == new_obj){\n      //Let's ensure that we have the a object\n      if(typeof a === 'undefined'){\n        var a = 'view';\n      }\n      //Add the automatic utag data points\n      utag.loader.RD(new_obj,a);\n    }\n    for(var i = 0; i &lt; temp_array_length; i++){\n        teal.processDataObject(temp_array[i],new_obj);\n    }\n  }else{\n    teal.processDataObject(obj,new_obj);\n  }\n  if(mergeObject){\n    //Need to delete everything out of obj and replace with new_obj\n    Object.keys(obj).forEach(function(key){\n      delete obj[key];\n    });\n    //Now that we have a clean original object, add everything from new_obj which allows the reference to be kept\n    Object.keys(new_obj).forEach(function(key){\n      obj[key] = new_obj[key];\n    });\n  }\n\n  return new_obj;\n}"},"3f3ef786b34d6dd716e1812c8b74a7a0e1f05aa5f3230588f6f5bcd00c6c8392":{"code":"// Flattener, pulled from https://tags.tiqcdn.com/utag/tealium-solutions/main/prod/utag.9.js as instructed by\n// https://community.tealiumiq.com/t5/iQ-Tag-Management/Data-Layer-Converter/ta-p/17581#toc-hId-1329378795\n\n//Define the teal global namespace\nwindow.teal = window.teal || {};\nteal.ignore_keys = {};\nteal.replace_keys = {};\nteal.prefix = &quot;&quot;;\n\n//In cases of a nested object, what should join the parent key and child key\nteal.nested_delimiter = &quot;.&quot;;\n\n//Ignore keys in the data layer that start with the following text.\n//Expecting an object of strings\n/*\nteal.ignore_keys = {\n  &quot;user&quot; : 1,\n  &quot;util&quot; : 1\n};\n*/\n\n//Specify a prefix for data layer elements being sent to the utag_data object.\n//Instead of utag_data.productID, it could be utag_data.dl_productID\n// teal.prefix = &quot;dl_&quot;;\n\n//Keys to be removed from the new flattened key name\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.page.pi.pageName\n/* teal.replace_keys = {\n    &quot;pageInfo&quot;:&quot;pi&quot;\n  };\n*/\n\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.page.pageName\n/* teal.replace_keys = {\n    &quot;pageInfo&quot;:&quot;&quot;\n  };\n*/\n\n//For a flattened key, you have digitalData.page.pageInfo.pageName and you want digitalData.pageName\n/* teal.replace_keys = {\n    &quot;page&quot;:&quot;&quot;,\n    &quot;pageInfo&quot;:&quot;&quot;\n  };\n*/\n\n/*****************DO NOT MODIFY BELOW***********************/\n\nteal.flattener_version = 1.4;\n\n// From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys\n// Add the Object.keys method for older versions of IE\nObject.keys||(Object.keys=function(){&quot;use strict&quot;;var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable(&quot;toString&quot;),c=[&quot;toString&quot;,&quot;toLocaleString&quot;,&quot;valueOf&quot;,&quot;hasOwnProperty&quot;,&quot;isPrototypeOf&quot;,&quot;propertyIsEnumerable&quot;,&quot;constructor&quot;],d=c.length;return function(e){if(&quot;object&quot;!=typeof e&amp;&amp;(&quot;function&quot;!=typeof e||null===e))throw new TypeError(&quot;Object.keys called on non-object&quot;);var g,h,f=[];for(g in e)a.call(e,g)&amp;&amp;f.push(g);if(b)for(h=0;h&lt;d;h++)a.call(e,c[h])&amp;&amp;f.push(c[h]);return f}}());\n\nteal.ignoreKey = function(key,re){\n  var should_ignore_key = 0;\n  //Build a new array to avoid running through Object.keys multiple times\n  if(typeof teal.ignore_keys_list === 'undefined'){\n    teal.ignore_keys_list = Object.keys(teal.ignore_keys);\n    teal.ignore_keys_list.forEach(function(name){\n      //Store a copy of the regex in the object\n      teal.ignore_keys[name] = new RegExp(&quot;^&quot;+name);\n      if(key.match(teal.ignore_keys[name])){\n        should_ignore_key = 1;\n      }\n    });\n  }else{\n    //Loop through the ignore_keys object to see if we should ignore this key\n    teal.ignore_keys_list.forEach(function(name){\n      if(key.match(teal.ignore_keys[name])){\n        should_ignore_key = 1;\n      }\n    });\n  }\n  return should_ignore_key;\n}\n\nteal.getKeyName = function(key,re){\n  //Create a new object to store regexs or use existing one\n  teal.replace_keys_regex = teal.replace_keys_regex || {};\n  //Build a new array to avoid running through Object.keys multiple times\n  if(typeof teal.replace_keys_list === 'undefined'){\n    teal.replace_keys_list = Object.keys(teal.replace_keys);\n    //Make a start of string and end of string regex\n    teal.replace_keys_regex.startOfString = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n    teal.replace_keys_regex.endOfString = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]$&quot;);\n    teal.replace_keys_list.forEach(function(name){\n      //Store a copy of the regex in the teal.replace_keys_regex object so that the regexs are only built once\n      teal.replace_keys_regex[name] = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]?&quot; + name + &quot;[&quot; + teal.nested_delimiter + &quot;]?&quot;, &quot;g&quot;);\n      key = teal.keyReplace(key,name,teal.replace_keys_regex[name]);\n    });\n  }else{\n    //Loop through the replace_keys object to see what we should be replacing\n    teal.replace_keys_list.forEach(function(name){\n      key = teal.keyReplace(key,name,teal.replace_keys_regex[name]);\n    });\n  }\n  return key;\n}\n\nteal.keyReplace = function(key,name,re){\n  //Check to see if we are replacing the key name with a new value or if we are removing the key altogether\n  if(teal.replace_keys[name] === ''){\n    //The key needs to be removed completely\n    key = key.replace(re,teal.nested_delimiter);\n    //Check to see if the key starts with the nested delimiter and if so, remove it\n    if(key.indexOf(teal.nested_delimiter) === 0){\n      var cleanRegEx = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n  }else{\n    //Make a copy of the original key to see how we need to update the key name\n    var origKey = key;\n    //Replace the key name\n    key = key.replace(re,teal.nested_delimiter + teal.replace_keys[name] + teal.nested_delimiter);\n    //Check for the start of the origKey to see of the nested delimiter is there\n    if(!origKey.match(teal.replace_keys_regex.startOfString)){\n      //Remove the nested delimiter from the start of the string\n      var cleanRegEx = new RegExp(&quot;^[&quot; + teal.nested_delimiter + &quot;]&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n    //Check for the end of the origKey to see of the nested delimiter is there\n    if(!origKey.match(teal.replace_keys_regex.endOfString)){\n      //Add the nested delimiter to the end of the string\n      var cleanRegEx = new RegExp(&quot;[&quot; + teal.nested_delimiter + &quot;]$&quot;);\n      key = key.replace(cleanRegEx,'');\n    }\n  }\n  return key;\n}\n\nteal.processDataObject = function(obj,new_obj,parent_key,create_array){\n  if(typeof parent_key === &quot;undefined&quot;){\n    //This object isn't nested in another object\n    parent_key = &quot;&quot;;\n  }else{\n    //Add the nested_delimiter to the parent key if the delimiter isn't already at the end\n    teal.nested_delimiter_regex = teal.nested_delimiter_regex || new RegExp(&quot;[&quot;+teal.nested_delimiter+&quot;]$&quot;);\n    if(!parent_key.match(teal.nested_delimiter_regex)){\n      parent_key += &quot;&quot;+teal.nested_delimiter;\n    }\n  }\n  Object.keys(obj).forEach(function(key){\n    var nested_key_name = parent_key+key;\n    //Format the new key name and take out any whitespace\n    var new_key_name = teal.getKeyName((teal.prefix+parent_key+key).replace(/\\s/g, ''));\n    //Set the key_type to limit the number of typeof checks\n    var key_type = teal.typeOf(obj[key]);\n    if(key_type !== 'undefined' &amp;&amp; key_type != null){\n      if(key_type.match(/boolean|string|number|date/) &amp;&amp; !teal.ignoreKey(key)){\n        //If obj[key] is a date, convert to ISOString\n        if(teal.typeOf(obj[key]) === 'date'){\n          obj[key] = obj[key].toISOString();\n        }\n        //Check to see if we need to create an array for this data point\n        if(create_array){\n          //First check to see if this key exists\n          if(teal.typeOf(new_obj[new_key_name]) !== &quot;array&quot;){\n            //Make the key an array                       \n            new_obj[new_key_name] = [];\n          }\n          new_obj[new_key_name].push(&quot;&quot;+obj[key]); //Force value to be a string\n        }else{\n          //If the value of the key is a boolean or a string or a number and \n          //the key shouldn't be ignored add to the data layer\n          new_obj[new_key_name] = &quot;&quot;+obj[key]; //Force value to be a string\n        }\n      }else if(key_type === 'object' &amp;&amp; !teal.ignoreKey(key)){\n        //Process this piece of the data layer and merge it\n        teal.processDataObject(obj[key],new_obj,nested_key_name,create_array);\n      }else if(key_type === 'array'){\n        teal.processDataArray(obj[key],new_obj,nested_key_name);\n      }\n    }\n  });\n}\n\nteal.processDataArray = function(obj,new_obj,parent_key){\n  var objLength = obj.length; \n  if(typeof parent_key === &quot;undefined&quot;){\n    //This object isn't nested in another object\n    parent_key = &quot;&quot;;\n  }else if(objLength &gt; 0 &amp;&amp; teal.typeOf(obj[0]).match(/boolean|string|number|date/)){\n    //This is a normal array that doesn't need a nested delimiter\n  }else{\n    //Add the nested_delimiter to the parent key\n    parent_key += &quot;&quot;+teal.nested_delimiter;\n  }\n  //Format the new key name and take out any whitespace\n  var new_key_name = teal.getKeyName((teal.prefix+parent_key).replace(/\\s/g, ''));\n  for(var n = 0; n &lt; objLength; n++){\n    var key_type = teal.typeOf(obj[n]);\n    if(key_type.match(/boolean|string|number|date/)){\n      //If obj[n] is a date, convert to ISOString\n      if(key_type === 'date'){\n        obj[n] = obj[n].toISOString();\n      }\n      //First check to see if this key exists\n      if(teal.typeOf(new_obj[new_key_name]) !== &quot;array&quot;){\n        //Make the key an array                       \n        new_obj[new_key_name] = [];\n      }\n      //If the value of the key is a boolean or a string or a number and \n      //the key shouldn't be ignored add to the data layer                        \n      new_obj[new_key_name].push(&quot;&quot;+obj[n]);\n    }else if(key_type === 'object'){\n      teal.processDataObject(obj[n],new_obj,new_key_name,1);\n    }\n  }\n}\n\nteal.typeOf = function(e){return ({}).toString.call(e).match(/\\s([a-zA-Z]+)/)[1].toLowerCase();}\n\nteal.flattenObject = function(obj,new_obj){\n  //Make sure object exists\n  if(typeof obj === 'undefined'){\n    return false;\n  }\n  //Check to see if we want to flatten the same object and keep the reference\n  var mergeObject = false;\n  if(obj === new_obj){\n    mergeObject = true;\n    //Start off a clean copy of the object\n    new_obj = {};\n  }\n  //Make sure new object exists\n  if(typeof new_obj === 'undefined'){\n    new_obj = {};\n  }\n  //Check to see if this object is an array\n  if(teal.typeOf(obj) === 'array'){\n    //Store a safe copy of this object in case we are processing the b object\n    var temp_array = JSON.parse(JSON.stringify(obj));\n    var temp_array_length = temp_array.length;\n    //Clean up the object\n    obj = {};\n    //Let's see if the obj and new_obj are the same.  If so, going to assume we are using the b object\n    if(obj == new_obj){\n      //Let's ensure that we have the a object\n      if(typeof a === 'undefined'){\n        var a = 'view';\n      }\n      //Add the automatic utag data points\n      utag.loader.RD(new_obj,a);\n    }\n    for(var i = 0; i &lt; temp_array_length; i++){\n        teal.processDataObject(temp_array[i],new_obj);\n    }\n  }else{\n    teal.processDataObject(obj,new_obj);\n  }\n  if(mergeObject){\n    //Need to delete everything out of obj and replace with new_obj\n    Object.keys(obj).forEach(function(key){\n      delete obj[key];\n    });\n    //Now that we have a clean original object, add everything from new_obj which allows the reference to be kept\n    Object.keys(new_obj).forEach(function(key){\n      obj[key] = new_obj[key];\n    });\n  }\n\n  return new_obj;\n}","name":"qa","promotedDraftName":"Draft 1","promotedTimestamp":"201906211317","promotedBy":"caleb.jaquith@tealium.com"}},"draftSeq":"1"},"status":"active","scope":"domready","constructor":"","advExecOption":"alr"}},"privacy_management":{"useTemplate":"true"},"title":"Version 2020.09.23.1203","email":"caleb.jaquith@tealium.com","datacloudLinkedProfiles":"{&quot;main&quot;:{&quot;rev&quot;:&quot;1600247595895&quot;,&quot;env&quot;:&quot;AudienceStream&quot;}}","datacloud_merge":"true","datacloud_profile_name":"main","datacloud_revision":"1625226277606","experiments":[{"id":"load_order_manager","enabled":false}]}
